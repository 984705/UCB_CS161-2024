#!/bin/sh

in="$(mktemp -u)"
out="$(mktemp -u)"

cleanup () {
    # Remove pipes.
    rm -f "$in" "$out"

    # Kill all shell processes.
    kill 0
}
trap cleanup EXIT
trap exit HUP INT QUIT TERM

# Make named pipes for program communication.
mkfifo "$in"
mkfifo "$out"

# Run interact repeatedly.
(
    while :; do
        ./interact -i "$in" -o "$out"
        while fuser "$in" >/dev/null || fuser "$out" >/dev/null; do
            sleep 1
        done
    done
) &

invoke -d orbit \< "$in" \> "$out"
